var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(i){"use strict";function t(){setTimeout(function(){l.style.backgroundImage="url("+i.background.image.url+m+"cb="+(new Date).getTime()+")",t()},c)}function e(){a=!0,i.background.useImage&&!u&&t(),s&&"function"==typeof s&&s()}function n(){var t;l=document.getElementById("background"),r=document.getElementById("backgroundStorage"),document.body.style.background=i.background.color,l?i.background.useImage?(l.className=i.background.image.position,l.className=i.background.image.scale?l.className+" scale-to-fit":l.className,u=0!==Object.keys(i.backgroundStorage).length,u?r?(r.addEventListener("rise-storage-response",function(i){i.detail&&i.detail.files&&i.detail.files.length>0&&(l.style.backgroundImage="url("+i.detail.files[0].url+")"),a||e()}),r.setAttribute("folder",i.backgroundStorage.folder),r.setAttribute("fileName",i.backgroundStorage.fileName),r.setAttribute("companyId",i.backgroundStorage.companyId),r.go()):console.log("Missing element with id value of 'backgroundStorage'"):(t=i.background.image.url.split("?"),m=1===t.length?"?":"&",l.style.backgroundImage="url("+i.background.image.url+")",e())):e():console.log("Missing element with id value of 'background'")}function o(i){a?i&&"function"==typeof i&&i():(i&&(s=i),n())}var s=null,a=!1,l=null,r=null,c=9e5,u=!1,m="";return{init:o}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Utilities=function(){function i(i,t){var e="font-family:"+t.font.family+"; ",n="color: "+t.color+"; ",o="font-size: "+t.size+"px; ",s="font-weight: "+(t.bold?"bold":"normal")+"; ",a="font-style: "+(t.italic?"italic":"normal")+"; ",l="text-decoration: "+(t.underline?"underline":"none")+"; ",r="background-color: "+t.highlightColor+"; ";return"."+i+" {"+e+n+o+s+a+l+r+"}"}function t(i){for(var t=document.createElement("style"),e=0,n=i.length;n>e;e++)t.appendChild(document.createTextNode(i[e]));document.head.appendChild(t)}function e(e,s){e.forEach(function(e){e.class&&e.fontSetting&&t([i(e.class,e.fontSetting)]),e.fontSetting.font.type&&("custom"===e.fontSetting.font.type&&e.fontSetting.font.family&&e.fontSetting.font.url?n(e.fontSetting.font.family,e.fontSetting.font.url,s):"google"===e.fontSetting.font.type&&e.fontSetting.font.family&&o(e.fontSetting.font.family,s))})}function n(i,t,e){var n=null,o="font-family: "+i+"; src: url('"+t+"');";e=e||document,n=e.styleSheets[0],null!==n&&n.addRule("@font-face",o)}function o(i,t){var e=document.createElement("link");t=t||document,e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","https://fonts.googleapis.com/css?family="+i),null!==e&&t.getElementsByTagName("head")[0].appendChild(e)}function s(i){for(var t=i.length,e=[],n=0;t>n;n++)e[n]=new Image,e[n].src=i[n]}function a(i){for(var t,e=window.location.search.substring(1),n=e.split("&"),o=0;o<n.length;o++)if(t=n[o].split("="),t[0]==i)return decodeURIComponent(t[1]);return""}return{getQueryParameter:a,getFontCssStyle:i,addCSSRules:t,loadFonts:e,loadCustomFont:n,loadGoogleFont:o,preloadImages:s}}();var WIDGET_COMMON_CONFIG={STORE_URL:"https://store-dot-rvaserver2.appspot.com/",AUTH_PATH_URL:"v1/widget/auth"},CollectionTimes=function(){function i(){function i(e,n){var o,s=6e4,a=new RiseVision.Common.Visualization;collectionTimesTimer=setTimeout(function(){i(e,n)},s),o={url:"http://contentfinancial2.appspot.com/info?codes="+e,refreshInterval:0,queryString:"select startTime, endTime, daysOfWeek, timeZoneOffset, updateInterval",callback:function(i,o){a=null,null!==i?(clearTimeout(o),t(e,i),n()):console.log("Error encountered loading collection times for: "+e)},params:collectionTimesTimer},a.getData(o)}function t(i,t){var n,o,s,a;if(null!==t){n=t.getNumberOfRows();for(var l=0;l<e.length;l++)if(e[l].instrument===i){a=t.getValue(0,3),o=t.getValue(0,0),s=t.getValue(0,1),e[l].collectionTimes={instrument:i,startTime:o.setTimezoneOffset(a),endTime:s.setTimezoneOffset(a),daysOfWeek:t.getFormattedValue(0,2).split(","),timeZoneOffset:a,isUpdated:!0};break}}}return{setIsUpdated:function(i,t){for(var n=0;n<e.length;n++)e[n].instrument===i&&null!==e[n].collectionTimes&&(e[n].collectionTimes.isUpdated=t)},addInstrument:function(t,n,o){for(var s=0,a=!1,l=!1;s<e.length;s++)if(e[s].instrument===t){null!==e[s].collectionTimes&&(Date.equals(Date.today(),n)||e[s].collectionTimes.isUpdated||(n=Date.today(),e[s].collectionTimes.startTime.addDays(1),e[s].collectionTimes.endTime.addDays(1),e[s].collectionTimes.isUpdated=!0),l=!0),a=!0;break}l?o(e[s].collectionTimes,n):(a||e.push({instrument:t,collectionTimes:null}),i(t,function(){o(e[s].collectionTimes,n)}))}}}var t=!1,e=[];return{getInstance:function(){return t||(t=i()),t}}}(),RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Financial=RiseVision.Common.Financial||{},RiseVision.Common.Financial.Helper={},RiseVision.Common.Financial.Helper=function(i){this.instruments=i},RiseVision.Common.Financial.Helper.prototype.setInstruments=function(i){this.instruments=i},RiseVision.Common.Financial.Helper.prototype.getInstruments=function(i,t){var e=this;if(i)return this.instruments.join("|");var n=(new Date).getDay(),o=t.length,s=[];return $.each(this.instruments,function(i,a){for(var l=0;o>l;l++)if(a===t[l].instrument){var r=t[l].startTime,c=t[l].endTime,u=t[l].daysOfWeek;$.each(u,function(t,o){return o==n?((new Date).between(r,c)&&s.push(e.instruments[i]),!1):void 0})}}),s.join("|")};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Financial=RiseVision.Common.Financial||{},RiseVision.Common.Financial.Historical={},RiseVision.Common.Financial.Historical.CollectionTimes={},RiseVision.Common.Financial.Historical=function(i,t,e){this.displayID=i?i:"preview",this.instrument=t,this.duration=e,this.isLoading=!0,this.updateInterval=6e4,this.now=Date.today(),this.url="https://contentfinancial2.appspot.com/data/historical?",this.historicalViz=new RiseVision.Common.Visualization,this.helper=new RiseVision.Common.Financial.Helper([this.instrument])},RiseVision.Common.Financial.Historical.prototype.setInstrument=function(i){this.isLoading=!0,this.instrument=i,this.helper.setInstruments([this.instrument])},RiseVision.Common.Financial.Historical.prototype.setDuration=function(i){this.duration=i},RiseVision.Common.Financial.Historical.prototype.setIsUpdated=function(i){CollectionTimes.getInstance().setIsUpdated(this.instrument,i)},RiseVision.Common.Financial.Historical.prototype.getHistoricalData=function(i,t,e){var n=this,o="select "+i.join()+" ORDER BY tradeTime",s="";e&&(e.sortOrder&&"desc"===e.sortOrder&&(o+=" desc"),e.limit&&(o+=" LIMIT "+e.limit)),CollectionTimes.getInstance().addInstrument(this.instrument,this.now,function(a,l){n.now=l,s=n.helper.getInstruments(n.isLoading,[a]),s?(e={url:n.url+"id="+n.displayID+"&code="+n.instrument+"&kind="+n.duration,refreshInterval:0,queryString:o,callback:function(i){n.onHistoricalDataLoaded(i,a,t)}},n.getHistoricalDataTimer=setTimeout(function(){n.getHistoricalData(i,t,e)},n.updateInterval),n.historicalViz.getData(e)):t(null)})},RiseVision.Common.Financial.Historical.prototype.onHistoricalDataLoaded=function(i,t,e){var n=0;null!==i?(clearTimeout(this.getHistoricalDataTimer),this.historicalData=i,n=i.getNumberOfRows(),this.isLoading=0===n||1===n&&"0"===i.getFormattedValue(0,0)?!0:!1,null!==this.historicalData?e({data:this.historicalData,collectionData:t}):e({collectionData:t})):(console.log("Error encountered loading historical data for: "),console.log(this))};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Financial=RiseVision.Common.Financial||{},RiseVision.Common.Financial.RealTime={},RiseVision.Common.Financial.RealTime=function(i,t,e){this.instruments=t,this.isLoading=!0,this.conditions={},this.collectionTimes=[],this.updateInterval=6e4,this.now=Date.today(),this.url="https://contentfinancial2.appspot.com/data?",this.logosURL="https://s3.amazonaws.com/risecontentlogos/financial/",this.viz=new RiseVision.Common.Visualization,this.helper=new RiseVision.Common.Financial.Helper(this.instruments),this._getDisplayId=function(){return i&&e.isAuthorized()?i:"preview"},this._saveCollectionTimes=function(){var i;if(i=this.data.getNumberOfRows(),1===this.instruments.length&&this.data.getNumberOfRows()>1)this._saveCollectionTime(0);else{for(var t=0;i>t;t++)this._saveCollectionTime(t);0===this.collectionTimes.length&&console.log(this.collectionTimes)}},this._saveCollectionTime=function(i){"INVALID_SYMBOL"!==this.data.getValue(i,0)&&("..."===this.data.getValue(i,0)?this.isLoading=!0:(timeZoneOffset=this.data.getValue(i,this.startTimeIndex+3),startTime=this.data.getValue(i,this.startTimeIndex),endTime=this.data.getValue(i,this.startTimeIndex+1),startTime&&endTime&&"N/P"!==timeZoneOffset&&this.collectionTimes.push({instrument:this.instruments[i],startTime:startTime.setTimezoneOffset(timeZoneOffset),endTime:endTime.setTimezoneOffset(timeZoneOffset),daysOfWeek:this.data.getFormattedValue(i,this.startTimeIndex+2).split(",")})))}},RiseVision.Common.Financial.RealTime.prototype.setInstruments=function(i){i=i.split(","),$.each(i,function(t){i[t]=$.trim(i[t])}),this.isLoading=!0,this.collectionTimes=[],this.instruments=i,this.helper.setInstruments(this.instruments)},RiseVision.Common.Financial.RealTime.prototype.getData=function(i,t,e,n){var o=this,s=!1,a=0,l="select instrument",r="";if(this.dataFields={},this.dataFields.instrument=0,this.startTimeIndex=1,this.isLoading&&(this.callback=n),$.each(i,function(i,t){s=!1,"instrument"===t||($.each(o.dataFields,function(i){return i===t?(s=!0,!1):void 0}),s||(l+=", "+t,o.dataFields[t]=a+1,a++,o.startTimeIndex++))}),this.logoCount=0,l+=", startTime, endTime, daysOfWeek, timeZoneOffset",!Date.equals(Date.today(),this.now)){this.now=Date.today();for(var c=0;c<this.collectionTimes.length;c++)this.collectionTimes[c].startTime.addDays(1),this.collectionTimes[c].endTime.addDays(1)}if(r=this.helper.getInstruments(this.isLoading,this.collectionTimes)){var u={url:this.url+"id="+this._getDisplayId()+"&codes="+r,refreshInterval:0,queryString:l,callback:function(i){o.onRealTimeDataLoaded(i,t,e)}};this.getDataTimer=setTimeout(function(){o.getData(i,t,e,n)},this.updateInterval),this.viz.getData(u)}else n(null)},RiseVision.Common.Financial.RealTime.prototype.onRealTimeDataLoaded=function(i,t,e){null!==i?(clearTimeout(this.getDataTimer),this.data=i,this.isLoading?(this.isLoading=!1,0===this.collectionTimes.length&&this._saveCollectionTimes(),t?this.loadLogos():this.callback&&this.callback(this.data,this.logoURLs)):t&&e?this.loadLogos():this.callback&&this.callback(this.data,this.logoURLs)):(console.log("Error encountered loading real-time data for: "),console.log(this.instruments[0]))},RiseVision.Common.Financial.RealTime.prototype.loadLogos=function(){var i=this.data.getNumberOfRows();this.logoCount=0,this.urls=[],this.logoURLs=[];for(var t=0;i>t;t++)this.urls.push(this.logosURL+this.data.getFormattedValue(t,0)+".svg");this.loadLogo(this.urls.length)},RiseVision.Common.Financial.RealTime.prototype.loadLogo=function(i){var t,e=this;t=new Image,t.onload=function(){e.logoURLs.push(t.src),e.onLogoLoaded(i)},t.onerror=function(){e.logoURLs.push(null),e.onLogoLoaded(i)},t.src=this.urls[this.logoCount]},RiseVision.Common.Financial.RealTime.prototype.onLogoLoaded=function(i){this.logoCount++,i--,0===i?this.callback&&this.callback(this.data,this.logoURLs):this.loadLogo(i)},RiseVision.Common.Financial.RealTime.prototype.checkSigns=function(i){var t,e,n=0,o=[];for(n=0,numRows=this.data.getNumberOfRows();numRows>n;n++)t=this.data.getValue(n,this.dataFields[i]),isNaN(t)&&(t=t.replace(/[^0-9\.-]+/g,""),t=parseFloat(t)),isNaN(t)||(e=t>=0?1:-1,o.push(e));return o},RiseVision.Common.Financial.RealTime.prototype.compare=function(i){var t=this,e=0,n=0,o=[],s=!1;if(this.conditions[i])for(row=0,numRows=this.data.getNumberOfRows();numRows>row;row++)e=this.data.getValue(row,this.dataFields[i]),s=!1,$.each(this.conditions[i],function(i,a){return a.instrument===t.data.getValue(row,0)?(n=a.value,isNaN(e)&&(e=e.replace(/[^0-9\.-]+/g,""),e=parseFloat(e)),isNaN(n)&&(n=n.replace(/[^0-9\.-]+/g,""),n=parseFloat(n)),isNaN(e)||isNaN(n)||(e!=n?e>n?o.push(1):o.push(-1):o.push(0)),s=!0,!1):void 0}),s||o.push(0);return this.saveBeforeValues([i]),o},RiseVision.Common.Financial.RealTime.prototype.saveBeforeValues=function(i){var t=this;$.each(i,function(i,e){t.conditions[e]=[],t.saveBeforeValue(e,t.dataFields[e])})},RiseVision.Common.Financial.RealTime.prototype.saveBeforeValue=function(i,t){for(var e=0,n=this.data.getNumberOfRows();n>e;e++)this.conditions[i].push({instrument:this.data.getValue(e,0),value:this.data.getValue(e,t)})};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.RiseCache=function(){"use strict";function i(){return"http://localhost:9494/?url="}function t(i){var t=new XMLHttpRequest;i&&"function"!=typeof i||(t.open("GET","http://localhost:9494/ping",!0),t.onreadystatechange=function(){try{4===t.readyState&&(200===t.status?i(!0,t.responseText):(console.debug("Rise Cache is not running"),i(!1,null)))}catch(e){console.debug("Caught exception: ",e.description)}},t.send())}return{ping:t,getUrl:i}}();var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Store=RiseVision.Common.Store||{},RiseVision.Common.Store.Auth={},RiseVision.Common.Store.Auth=function(){function i(i){e=document.createElement("div"),e.className="overlay",document.body.appendChild(e),n=document.createElement("div"),n.className="auth-warning",n.innerHTML=i,n=document.body.appendChild(n)}function t(){e&&n&&(n.parentNode.removeChild(n),e.parentNode.removeChild(e))}var e,n,o=36e5;this.callback=null,this.authorized=!1,this.isAuthorized=function(){return this.authorized},this.checkForDisplay=function(i,t,e){this.callback=e,this.url=WIDGET_COMMON_CONFIG.STORE_URL+WIDGET_COMMON_CONFIG.AUTH_PATH_URL+"?id="+i+"&pc="+t,this.callApi()},this.checkForCompany=function(i,t,e){this.callback=e,this.url=WIDGET_COMMON_CONFIG.STORE_URL+WIDGET_COMMON_CONFIG.AUTH_PATH_URL+"?cid="+i+"&pc="+t,this.callApi()},this.callApi=function(){var i=this;$.ajax({dataType:"json",url:this.url,success:function(t,e){i.onSuccess(t,e)},error:function(){i.onError()}})},this.onSuccess=function(e){if(e&&e.authorized){this.authorized=!0,t();var n=new Date(e.expiry).getTime()-(new Date).getTime()-o;setTimeout(this.callApi,n)}else e&&!e.authorized?(this.authorized=!1,i("Product not authorized."),setTimeout(this.callApi,o)):setTimeout(this.callApi,o);this.callback&&this.callback(this.authorized)},this.onError=function(){this.authorized=!1,i("Cannot connect to Store for authorization."),setTimeout(this.callApi,o),this.callback&&this.callback(this.authorized)}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function i(i){return document.getElementById(r+i)}function t(t){var e,n=i(t);return e=n.querySelector("iframe"),e?e.contentWindow?e.contentWindow:e.contentDocument.document?e.contentDocument.document:e.contentDocument:null}function e(e){var n,o=i(e),s=t(e);s&&(n=o.querySelector("iframe"),s.remove(),n.setAttribute("src","about:blank"))}function n(t){var e=i(t),n=document.createElement("iframe");n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),e.appendChild(n)}function o(e,n,o,s,a){var l,r=i(e),c=t(e);c&&(l=r.querySelector("iframe"),l.onload=function(){l.onload=null,c.init(n,o,s),c.load()},l.setAttribute("src",a))}function s(t){var e=i(t);e.style.visibility="hidden"}function a(i,t){var n=document.getElementById(r+i);e(i),setTimeout(function(){for(;n.firstChild;)n.removeChild(n.firstChild);t&&"function"==typeof t&&t()},200)}function l(t){var e=i(t);e.style.visibility="visible"}var r="if_";return{add:n,createFramePlayer:o,getFrameContainer:i,getFrameObject:t,hide:s,remove:a,show:l}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Visualization={},RiseVision.Common.Visualization=function(){this.query=null,this.isVisualizationLoaded=!1},RiseVision.Common.Visualization.prototype.getData=function(i){this.url=i.url,this.refreshInterval=i.refreshInterval,this.timeout=i.timeout||30,this.callback=i.callback,this.params=i.params,i.queryString&&(this.queryString=i.queryString),this.isVisualizationLoaded?this.sendQuery():this.loadVisualizationAPI()},RiseVision.Common.Visualization.prototype.loadVisualizationAPI=function(){var i=this;google.load("visualization","1",{callback:function(){i.isVisualizationLoaded=!0,i.sendQuery()}})},RiseVision.Common.Visualization.prototype.sendQuery=function(){var i=this;null!==this.query&&this.query.abort(),this.query=new google.visualization.Query(this.url),this.query.setRefreshInterval(this.refreshInterval),this.query.setTimeout(this.timeout),this.queryString&&this.query.setQuery(this.queryString),this.query.send(function(t){i.onQueryExecuted(t)})},RiseVision.Common.Visualization.prototype.onQueryExecuted=function(i){null===i?this.callback(i,this.params):i.isError()?(console.log("Message: "+i.getMessage()),console.log("Detailed message: "+i.getDetailedMessage()),console.log("Reasons: "+i.getReasons()),this.callback(null,this.params)):this.callback(i.getDataTable(),this.params)};